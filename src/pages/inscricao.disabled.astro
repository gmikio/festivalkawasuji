---
import Layout from "@layouts/Layout.astro";
---

<Layout title="Inscrições Gerais - XVII Festival Kawasuji de Taiko">
  <main class="min-h-screen flex flex-col items-center">
    <!-- Header Section -->
    <header class="text-center py-12">
      <h1 class="text-4xl font-bold text-[#101a61]">INSCRIÇÕES GERAIS</h1>
      <h2 class="text-2xl font-bold text-[#101a61] mt-4">
        XVII FESTIVAL KAWASUJI DE TAIKO
      </h2>
    </header>

    <!-- Main Content -->
    <div class="w-full max-w-4xl px-4 py-8 bg-white rounded-lg shadow-lg mb-12">
      <section class="text-center mb-8">
        <p class="text-lg text-slate-700">
          Depois de muita espera, estão finalmente abertas as inscrições gerais
          para o 17º Festival Kawasuji de Taiko!
        </p>
        <button
          class="bg-[#9e0101] text-white py-2 px-6 rounded-full mt-6 hover:bg-[#530101]"
          onclick="document.getElementById('calculator').scrollIntoView({ behavior: 'smooth' })">
          Prosseguir
        </button>
      </section>

      <!-- Calculator Section -->
      <section
        id="calculator"
        class="bg-[#f9f9f9] p-8 rounded-lg shadow-md mt-8">
        <h2 class="text-2xl font-bold text-[#101a61] text-center">
          Calculadora de Custos do Evento
        </h2>

        <!-- Formulário de Grupo -->
        <div id="group-calculator" class="mt-4 space-y-4">
          <h3 class="text-lg font-bold text-slate-700 text-center">
            Inscrição para Grupos
          </h3>
          <div>
            <label for="uf-group" class="block text-lg text-slate-700">
              UF da cidade do grupo:
            </label>
            <select
              id="uf-group"
              class="w-full p-2 border rounded-md text-slate-600">
              <option value="">Selecione</option>
              <option>AC</option>
              <option>AL</option>
              <option>AP</option>
              <option>AM</option>
              <option>BA</option>
              <option>CE</option>
              <option>DF</option>
              <option>ES</option>
              <option>GO</option>
              <option>MA</option>
              <option>MT</option>
              <option>MS</option>
              <option>MG</option>
              <option>PA</option>
              <option>PB</option>
              <option>PR</option>
              <option>PE</option>
              <option>PI</option>
              <option>RJ</option>
              <option>RN</option>
              <option>RS</option>
              <option>RO</option>
              <option>RR</option>
              <option>SC</option>
              <option>SP</option>
              <option>SE</option>
              <option>TO</option>
            </select>
          </div>
          <div>
            <label for="qtd-adults-group" class="block text-lg text-slate-700">
              Quantidade de adultos - acima de 12 anos (alimentação):
            </label>
            <input
              type="number"
              id="qtd-adults-group"
              class="w-full p-2 border rounded-md"
            />
          </div>
          <div>
            <label
              for="qtd-children-group"
              class="block text-lg text-slate-700">
              Quantidade de crianças - 12 anos ou menos (alimentação):
            </label>
            <input
              type="number"
              id="qtd-children-group"
              class="w-full p-2 border rounded-md"
            />
          </div>
          <div>
            <label for="qtd-total-group" class="block text-lg text-slate-700">
              Quantidade de adultos + crianças (pernoite):
            </label>
            <input
              type="number"
              id="qtd-total-group"
              class="w-full p-2 border rounded-md"
            />
          </div>
        </div>

        <!-- Formulário Individual -->
        <div id="individual-calculator" class="mt-4 space-y-4 hidden">
          <h3 class="text-lg font-bold text-slate-700 text-center">
            Inscrição Individual
          </h3>
          <div>
            <label for="qtd-workshop" class="block text-lg text-slate-700">
              Quantidade de tocadores que participarão do Workshop:
            </label>
            <input
              type="number"
              id="qtd-workshop"
              class="w-full p-2 border rounded-md"
            />
          </div>
          <div>
            <label
              for="qtd-adults-individual"
              class="block text-lg text-slate-700">
              Quantidade de adultos - acima de 12 anos (alimentação):
            </label>
            <input
              type="number"
              id="qtd-adults-individual"
              class="w-full p-2 border rounded-md"
            />
          </div>
          <div>
            <label
              for="qtd-children-individual"
              class="block text-lg text-slate-700">
              Quantidade de crianças - 12 anos ou menos (alimentação):
            </label>
            <input
              type="number"
              id="qtd-children-individual"
              class="w-full p-2 border rounded-md"
            />
          </div>
          <div>
            <label
              for="qtd-total-individual"
              class="block text-lg text-slate-700">
              Quantidade de adultos + crianças (pernoite):
            </label>
            <input
              type="number"
              id="qtd-total-individual"
              class="w-full p-2 border rounded-md"
            />
          </div>
        </div>

        <div class="text-center mt-6">
          <button
            class="bg-[#2641c6ff] text-white py-2 px-6 rounded-full hover:bg-[#101a61ff]"
            id="calculate-button">
            Calcular Total
          </button>
          <div class="mt-6 text-center">
            <p id="result" class="text-2xl font-bold mb-6 text-[#2641c6ff]"></p>
            <a
              id="form-link"
              href="#"
              class="hidden bg-[#2641c6ff] text-white py-2 px-6 rounded-full mt-6 hover:bg-[#101a61ff]"
              target="_blank">
              Ir para Formulário
            </a>
          </div>
          <div class="text-center mt-4">
            <button class="text-blue-500 underline" id="toggle-calculator">
              Obs: É uma Inscrição Individual?
            </button>
          </div>
        </div>
      </section>

      <script>
        const toggleButton = document.getElementById("toggle-calculator");
        const groupCalculator = document.getElementById("group-calculator");
        const individualCalculator = document.getElementById(
          "individual-calculator"
        );
        const calculateButton = document.getElementById("calculate-button");
        const resultElement = document.getElementById("result");
        const formLink = document.getElementById("form-link");

        if (
          toggleButton &&
          groupCalculator &&
          individualCalculator &&
          calculateButton &&
          resultElement &&
          formLink
        ) {
          toggleButton.addEventListener("click", () => {
            groupCalculator.classList.toggle("hidden");
            individualCalculator.classList.toggle("hidden");
            resultElement.textContent = "";
            formLink.classList.add("hidden");
            toggleButton.innerText = groupCalculator.classList.contains(
              "hidden"
            )
              ? "Voltar para Inscrição de Grupo"
              : "Obs: É uma Inscrição Individual?";
          });

          calculateButton.addEventListener("click", () => {
            let total = 0;
            let formUrlBase = "";

            if (!groupCalculator.classList.contains("hidden")) {
              // Calculadora para grupos
              formUrlBase =
                "https://docs.google.com/forms/d/e/1FAIpQLSfjykJCpEdSFS8YzgrZOHKo9gx0Z0WKYO4BLOKmwOynmsWKIw/viewform?usp=pp_url&";

              const uf = (document.getElementById("uf-group") as HTMLSelectElement)?.value || "";
              const qtdAdults =
                parseInt((document.getElementById("qtd-adults-group") as HTMLInputElement)?.value) ||
                0;
              const qtdChildren =
                parseInt(
                  (document.getElementById("qtd-children-group") as HTMLInputElement)?.value
                ) || 0;
              const qtdTotal =
                parseInt((document.getElementById("qtd-total-group") as HTMLInputElement)?.value) ||
                0;

              const baseCost = uf === "SP" ? 1000 : 750;
              total =
                baseCost + qtdAdults * 192 + qtdChildren * 123 + qtdTotal * 30;

              const idUF = "entry.369296670";
              const foodEntryId = "entry.1549837914";
              const childFoodEntryId = "entry.424212885";
              const accommodationEntryId = "entry.1083938500";

              const formUrl =
                formUrlBase +
                `${idUF}=${uf}&${foodEntryId}=${qtdAdults}&${childFoodEntryId}=${qtdChildren}&${accommodationEntryId}=${qtdTotal}`;

              (formLink as HTMLAnchorElement).href = formUrl;
            } else {
              // Calculadora individual
              formUrlBase =
                "https://docs.google.com/forms/d/e/1FAIpQLSeaHhdD_0Y9_fh1F-T6Q_2yTPuQNUzDpHta1JIs3sfdD1YZ7Q/viewform?usp=pp_url&";

              const qtdWorkshop =
                parseInt((document.getElementById("qtd-workshop") as HTMLInputElement)?.value) || 0;
              const qtdAdults =
                parseInt(
                  (document.getElementById("qtd-adults-individual") as HTMLInputElement)?.value
                ) || 0;
              const qtdChildren =
                parseInt(
                  (document.getElementById("qtd-children-individual") as HTMLInputElement)?.value
                ) || 0;
              const qtdTotal =
                parseInt(
                  (document.getElementById("qtd-total-individual") as HTMLInputElement)?.value
                ) || 0;

              total =
                qtdWorkshop * 150 +
                qtdAdults * 192 +
                qtdChildren * 123 +
                qtdTotal * 30;

              const workshopEntryId = "entry.675671558";
              const foodEntryId = "entry.1549837914";
              const childFoodEntryId = "entry.424212885";
              const accommodationEntryId = "entry.1083938500";

              const formUrl =
                formUrlBase +
                `${workshopEntryId}=${qtdWorkshop}&${foodEntryId}=${qtdAdults}&${childFoodEntryId}=${qtdChildren}&${accommodationEntryId}=${qtdTotal}`;

              (formLink as HTMLAnchorElement).href = formUrl;
            }

            resultElement.textContent = `Valor Total: R$ ${total.toFixed(2)}`;
            formLink.classList.remove("hidden");
          });
        }
      </script>
    </div>
  </main>
</Layout>
